---
layout: mypost
title: Android编译焯极新手教程
categories: [Android]
---

#### 新手应该都会吧？（应该）
#### 本教程以使用Ubuntu 21.10为Redmi K30 Pro编译Pixel Experience为例进行教学

# 准备工作
###### 1.一台搭载Ubuntu 21.10的机器（具体安装自行百度或谷歌，可以双系统）
###### 2.机器要求配置如下：

```
一个 x86_64 架构的 CPU，性能越强越好
至少 16G 运行内存（这是编译安卓11与12的要求，老的系统好像只需要8G）
至少 200G 的空闲磁盘空间（硬盘最好是SSD）
```

###### 3.遇到困难不要放弃，坚持寻找问题并在各大博客等地方请求帮助
###### 4.网络一定要通畅！通畅！用国内网一定要挂梯子！不然同步源码会裂开
###### 5.一定得有自己的GitHub账号！


# 准备
###### 1.先选择自己想要编译的ROM
###### 如：

```
Pixel Experience
Lineage OS
CrDroid
Havoc OS
Evolution X
Arrow OS
......
```

###### 2.选择好要编译的ROM后，在Ubuntu打开终端，并切换到root用户（具体操作百度和谷歌都有，这里不详细讲）
###### 3.安装编译 Android 所用到的软件包（复制粘贴Enter就完事了，多简单？）

> 注意一点：第二条apt-get指令在部分服务器无法正常完全安装（如阿里云），解决办法是查看最后报出来没安装的几个包并在代码中删除对应的包，再粘贴到终端中运行即可

```
apt-get update && apt-get upgrade -y
apt-get install -y openjdk-8-jdk git gnupg flex bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses-dev libncurses5 x11proto-core-dev libx11-dev lib32z1-dev libgl1-mesa-dev libxml2-utils xsltproc unzip bc imagemagick ccache schedtool libssl-dev jq patchelf python-is-python3
```

###### 4.设置 Git 信息

```
git config --global user.name "在此处替换成你的名字"
git config --global user.email "在此处替换成你的邮箱"
```

> 示例

```
git config --global user.name "Zj031210"
git config --global user.email "alonzomax1210@gmail.com"
```

###### 5.下载 Repo

```
mkdir ~/.bin
PATH=~/.bin:$PATH
curl https://storage.googleapis.com/git-repo-downloads/repo > ~/.bin/repo
chmod +x ~/.bin/repo
```

###### 6.建立一个文件夹，并进入

> 文件夹名字随便，例如我要编译PE我可以设置为PE,我要编译Los可以设置为Lineage，这里我以PE作为例子

```
mkdir PE && cd PE
```

###### 7.去谷歌一下你要编译的ROM的名字+GitHub

```
依然以PE作为例子，我谷歌的内容是Pixel Experience Github
进入PE的GitHub，找到Repositories，点击它，然后在列表内找到manifest，点击并进入
```

###### 8.找到Sync部分，代码框内有两条代码

> 这里还是以PE作为例子

```
# Initialize local repository
repo init -u https://github.com/PixelExperience/manifest -b twelve

# Sync
repo sync -c -j$(nproc --all) --force-sync --no-clone-bundle --no-tags
```

> 下面是这两行代码的用途，请记好

```
初始化本地仓库 repo init -u https://github.com/PixelExperience/manifest -b twelve
同步源码 repo sync -c -j$(nproc --all) --force-sync --no-clone-bundle --no-tags
```

###### 9.在终端中输入初始化仓库的代码

```
repo init -u https://github.com/PixelExperience/manifest -b twelve
```

> 注意：有可能会让你看一堆颜色让你回复y还是n，遇到这种情况直接回复y就行（也就是yes啦）

###### 10.检查一遍自己的网络是否通畅

```
若是在自己家用自己的机器编译，要注意挂梯子，推荐用V2Ray挂梯子比较好，Clash极力不推荐（踩过坑，虽然不知道是不是自己端口啥的设置错了，但是我用QV2Ray连梯子比Clash的配置要舒服得多）
若是在服务器上编译，要注意服务器机房设置在国内还是国外（香港、澳门的服务器连的是外网），在国内的话需要挂梯子（有得选肯定选国外的啦）
```

###### 11.开始同步

```
repo sync -c -j$(nproc --all) --force-sync --no-clone-bundle --no-tags
```

> 过程很漫长，视网速而定（开梯子的还得看你梯子服务商行不行)
> 我用自己电脑编译的，网速大概在10-15mb/s左右, 同步了大概2-3小时, 大概50个G左右
> 所以挂梯子的要准备好流量, 不然同步到一半没流量了, 那我只好送首凉凉给你听233

###### 12.同步完成后我们还需要下载两个工具包

> GCC

```
git clone --depth=1 https://github.com/arter97/arm64-gcc -b master prebuilts/gcc/linux-x86/aarch64/aarch64-elf
git clone --depth=1 https://github.com/arter97/arm32-gcc -b master prebuilts/gcc/linux-x86/arm/arm-eabi
```

> Clang

```
git clone --depth=1 https://github.com/kdrag0n/proton-clang -b master prebuilts/clang/host/linux-x86/clang-proton
```

13.开始构建。

> 加载编译环境

```
source build/envsetup.sh
```

###### 做完这一步，准备过程就完成啦！

